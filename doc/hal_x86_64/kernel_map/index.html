<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `kernel_map` mod in crate `hal_x86_64`."><meta name="keywords" content="rust, rustlang, rust-lang, kernel_map"><title>hal_x86_64::kernel_map - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css"><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../hal_x86_64/index.html'><div class='logo-container'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Module kernel_map</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'><a href='../index.html'>hal_x86_64</a></p><script>window.sidebarCurrent = {name: 'kernel_map', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/hal_x86_64/kernel_map.rs.html#1-43' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../index.html'>hal_x86_64</a>::<wbr><a class="mod" href=''>kernel_map</a></span></h1><div class='docblock'><p>This module contains constants that define how the kernel address space is laid out on x86_64. The 511th P4
entry (virtual addresses <code>0xffff_ff80_0000_0000</code> through <code>0xffff_ffff_ffff_ffff</code>) is always mapped to the
kernel P3. The rest of the virtual address space (virtual addresses <code>0x0000_0000_0000_0000</code> through
<code>0xffff_ff7f_ffff_ffff</code> are free for userspace to use).</p>
<p>This gives us 512 GiB of kernel space. The kernel itself is built with the <code>kernel</code> mc-model, and so must lie
in the -2GiB of the address space (the top two entries of the kernel P3). The remaining 510 GiB of the kernel
P3 is used to map the entirety of physical memory into the kernel address space, and for task kernel stacks.</p>
<p>Directly below the base of the kernel, we reserve 128GiB for task kernel stacks, which gives us a maximum of
65536 tasks if each one has the default stack size.</p>
<p>This leaves us 382GiB for the physical memory map, which should be sufficient for any system I can imagine us
running on (famous last words).</p>
</div><h2 id='constants' class='section-header'><a href="#constants">Constants</a></h2>
<table><tr class='module-item'><td><a class="constant" href="constant.KERNEL_ADDRESS_SPACE_START.html" title='hal_x86_64::kernel_map::KERNEL_ADDRESS_SPACE_START constant'>KERNEL_ADDRESS_SPACE_START</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_BASE.html" title='hal_x86_64::kernel_map::KERNEL_BASE constant'>KERNEL_BASE</a></td><td class='docblock-short'><p>The kernel starts at -2GiB. The kernel image is loaded directly at this address, and the following space until
the top of memory is managed dynamically and contains the boot info structures, memory map, and kernel heap.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_P4_ENTRY.html" title='hal_x86_64::kernel_map::KERNEL_P4_ENTRY constant'>KERNEL_P4_ENTRY</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_STACKS_BASE.html" title='hal_x86_64::kernel_map::KERNEL_STACKS_BASE constant'>KERNEL_STACKS_BASE</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.MAX_TASKS.html" title='hal_x86_64::kernel_map::MAX_TASKS constant'>MAX_TASKS</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.PHYSICAL_MAPPING_BASE.html" title='hal_x86_64::kernel_map::PHYSICAL_MAPPING_BASE constant'>PHYSICAL_MAPPING_BASE</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.STACK_SLOT_SIZE.html" title='hal_x86_64::kernel_map::STACK_SLOT_SIZE constant'>STACK_SLOT_SIZE</a></td><td class='docblock-short'></td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.physical_to_virtual.html" title='hal_x86_64::kernel_map::physical_to_virtual fn'>physical_to_virtual</a></td><td class='docblock-short'><p>Access a given physical address through the physical mapping. This cannot be used until the kernel page tables
have been switched to.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "hal_x86_64";</script><script src="../../aliases.js"></script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>